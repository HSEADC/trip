<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Угадай город по новости</title>
    <link rel="icon" type="image/png" href="../images/favicon.svg">

</head>
<body id="blue-grey" class="test">
    <div class="games">
    <!-- менюшки  -->
    <div class="menu">
        <a href="../index.html">
            <div class="Logo">
                <img src="../images/Logo/Logo.svg" alt="">
            </div>
        </a>
        <div class="icons">
            <a href="../Trips.html">
                <div class="A_Menu-Routes">
                    <div class="Q_Menu-Routes">
                        <img src="../images/Q_Menu/3dicons.png" alt="">
                    </div>
                    <p class="p-desktop">Маршруты</p>
                </div>
            </a>
            <a href="../Advices.html">
                <div class="A_Menu-Advice">
                        <div class="Q_Menu-Adviсe">
                            <img src="../images/Q_Menu/road-bag 1.png" alt="">
                        </div>
                        <p class="p-desktop">Советы</p>
                </div>
            </a>
            <a href="../games.html">
                <div class="A_Menu-Way">
                    <div class="Q_Menu-Way">
                        <img src="../images/Q_Menu/pin 1.png" alt="">
                    </div>
                    <p class="p-desktop">В пути</p>
                </div>
            </a>
        </div>
        <div class="A_Search">
            <div class="Q_Icons-Search">
                <img src="../images/Q_Icons/Search.svg" alt="">
            </div>
            <p class="p-desktop">Поиск</p>
        </div>
    </div>
    <div class="menu-mobile">
        <a href="../index.html">
            <div class="Symbol">
                <img src="../images/Logo/Union.svg" alt="">
            </div>
        </a>
        <div class="A_Search">
            <div class="Q_Icons-Search">
                <img src="../images/Q_Icons/Search.svg" alt="">
            </div>
            <p class="p-desktop">Поиск</p>
        </div>
        <div class="Q_Icons-Burger">
            <img src="../images/Q_Icons/Burger.svg" alt="">
        </div>
    </div>
    <div class="blur-mobile"></div>
    <div class="none">
        <div class="mobile-popupMenu">
            <div class="icons-mobile">
                <div class="burger-menu">
                    <a href="../Trips.html">
                        <div class="A_Menu-Routes">
                            <div class="Q_Menu-Routes">
                                <img src="../images/Q_Menu/3dicons.png" alt="">
                            </div>
                            <p class="p-desktop">Маршруты</p>
                        </div>
                    </a>
                    <div class="mini-menu">
                        <div class="Q_Icons-Cross close">
                            <img src="../images/Q_Icons/Cross.svg" alt="">
                        </div>
                    </div>
                </div>
                <a href="../Advices.html">
                    <div class="A_Menu-Advice">
                            <div class="Q_Menu-Adviсe">
                            <img src="../images/Q_Menu/road-bag 1.png" alt="">
                            </div>
                            <p class="p-desktop">Советы</p>
                    </div>
                </a>
                <a href="../games.html">
                    <div class="A_Menu-Way">
                        <div class="Q_Menu-Way">
                            <img src="../images/Q_Menu/pin 1.png" alt="">
                        </div>
                        <p class="p-desktop">В пути</p>
                    </div>
                </a>
            </div>
        </div>
    </div>
    <div class="main-container">
        <div class="greeting">
            <h2 class="h2-desktop">Угадай город по&nbsp;новости</h2>
            <div class="A_Tag">
                <p class="p-desktop">Опрос</p>
            </div>
            <p class="p-desktop">Вы&nbsp;точно должны были хотя&nbsp;бы раз в&nbsp;жизни слышать абсурдные, смешные новости. Настолько смешные и&nbsp;нереальные, что непонятно было, как он&nbsp;вообще попалт в&nbsp;газеты. Сегодня мы&nbsp;предлагаем вам потренироваться и&nbsp;понять, как хорошо вы&nbsp;знаете города, из&nbsp;которых эти новости приходят</p>
            <button onclick="hideBlock()">Начнём!</button>
        </div>
    </div>

    <div class="container">
		<div class="task">
			<h3 id="question" class="h3-desktop">EMPTY</h3>
			<div id="answers" class="p-desktop">
				EMPTY
			</div>
			<button onclick="sendResult()">Дальше</button>
		</div>
	</div>

    </div>


    <div id="blue-grey" class="footer">
        <div class="Symbol">
            <img src="../images/Logo/Union.svg" alt="">
        </div>
        <div class="hse adc">
            <p class="p-desktop">HSE ADC</p>
        </div>
        <div class="socials">
            <a href="https://t.me/trippppppp">
                <div class="Q_Social-TG">
                    <img src="../images/Q_Social/TG.svg" alt="">
                </div>
            </a>
            <a href="https://www.youtube.com/channel/UCxXUroj1PZmdlXSXDWVv72w">
                <div class="Q_Social-IG">
                    <img src="../images/Q_Social/YT.svg" alt="">
                </div>
            </a>
            <a href="https://vk.com/tripppppppppppppppppp">
                <div class="Q_Social-VK">
                    <img src="../images/Q_Social/VK.svg" alt="">
                </div>
            </a>
            <a href="https://dzen.ru/id/660491df3de7862a70cc4818">
                <div class="Q_Social-Dzen">
                    <img src="../images/Q_Social/Dzen.svg" alt="">
                </div>
            </a>
        </div>
    </div>
    <script>
        
        function hideBlock() {
	document.querySelector('.main-container').style.display = 'none';
	document.querySelector('.container').style.display = 'flex';
	let footer = document.querySelector('.footer');
	footer.style.position = 'absolute';
	footer.style.width = '95vw';
	footer.style.bottom = '0';
    if (window.matchMedia("(max-width: 480px)").matches) {
        footer.style.width = '89.4vw';
    }
    }



let taskName = "";
let questions = [];
let answers = [];
let results = new Map();
let way = [];
let step = 0;
let last = 0;

window.onload = init

function getCookie(name) {
let matches = document.cookie.match(new RegExp(
"(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
));
return matches ? decodeURIComponent(matches[1]) : undefined;
} 
// возможно куки не нужны

function setCookie(name, value, path = "/question", options = {}) {

options = {
path: path,
...options
};

if (options.expires instanceof Date) {
options.expires = options.expires.toUTCString();
}

let updatedCookie = encodeURIComponent(name) + "=" + encodeURIComponent(value);

for (let optionKey in options) {
updatedCookie += "; " + optionKey;
let optionValue = options[optionKey];
if (optionValue !== true) {
  updatedCookie += "=" + optionValue;
}
}

document.cookie = updatedCookie;
}

function getDataDB(taskName) {
questions = ["Антиноев ковчег с\u00A0красными помидорами и\u00A0синими мужиками\u00A0— это новость\u00A0из...", "Вооруженные ножами бабушки напали на\u00A0футболистов. «раз начал защищать двор, то\u00A0иди в\u00A0своем увлечении до\u00A0конца»\u00A0— это новость\u00A0из...", "Мужчина подрался с\u00A0соседом из-за поломанных растений и\u00A0попал под суд\u00A0— это новость\u00A0из...", "В\u00A0каком-то городе бомж забрался в\u00A0кондитерскую\u00A0и, возможно, смеялся. Где это было?"];
answers = [["Подольск", "Архангельск", "Саратов", "Сложный вопрос, давайте дальше"], ["Санкт-петербург", "Таруса", "Ничего не понимаю, дальше", "поселок Юбилейный"], ["Архангельск", "Воронеж", "Из-за растений в суд? бред!", "Нижний Новгород"], ["Тула", "Это же вообще не новости!!", "Воронеж", "Подольск"]];
way = [["не очень хорошо разбираешься в новостях", "очень хорошо разбираешься в локальных новостях", "не очень хорошо разбираешься в новостях", "зануда"], ["не очень хорошо разбираешься в новостях", "не очень хорошо разбираешься в новостях", "зануда", "очень хорошо разбираешься в локальных новостях",], ["не очень хорошо разбираешься в новостях", "очень хорошо разбираешься в локальных новостях", "зануда", "не очень хорошо разбираешься в новостях",], ["очень хорошо разбираешься в локальных новостях", "зануда", "не очень хорошо разбираешься в новостях", "не очень хорошо разбираешься в новостях"]];

return [questions, answers, way]
}

function init() {
let taskName = getCookie("taskName");

[this.questions, this.answers, this.way] = getDataDB(taskName);
step = 0;
last = this.questions.length-1
initUI();
}

function initUI() {
let div = document.querySelector("#answers");
let answerField = "";
document.querySelector("#question").innerText = this.questions[step];

this.answers[step].forEach((e, index) => {
	answerField += '<div style="margin-bottom: 0.83vw;">\
						<input type="radio" id="ANS' + index + '" class="answers" name="answer' + this.questions[step] + '" value="' + e + '"/>\n\
						<label for="ANS' + index + '">' + e + '</label>\
					</div>'
});

div.innerHTML = answerField;
}

function initFinishUI() {
let result = finishQuestion();
let container = document.querySelector(".container");

let resultDiv = document.createElement('div');
resultDiv.classList.add('result');

let congrats = "Поздравляем, ты – " + result[0][0] + "!";
let description = "";

switch (result[0][0]) {
	case "не очень хорошо разбираешься в новостях":
		description = "Оказывается, ты&nbsp;не&nbsp;очень хорошо разбираешься в&nbsp;локальных новостях, но&nbsp;ничего! Это всегда можно поправить, если почитать достаточное количество местных новостных медиа";
		break;
	case "очень хорошо разбираешься в локальных новостях":
		description = "Вот это&nbsp;да! Мы&nbsp;и&nbsp;представить себе не&nbsp;могли, что ты&nbsp;настолько хорошо знаешь все новости из&nbsp;России. Признавайся, сколько ты&nbsp;их&nbsp;прочитал перед тем, как пройти наш тест?";
		break;
	case "зануда":
		description = "Эй! Нечестно весь тест отвечать, что ты&nbsp;не&nbsp;знаешь! Лучше честно показать, что не&nbsp;знаешь ничего о&nbsp;русских городах, тест то&nbsp;тебя точно не&nbsp;осудит за&nbsp;незнание";
		break;

	default:
		description = "Ты – " + result[0][0] + ".";
}

resultDiv.innerHTML = "<h1 class='congrats'>" + congrats + "</h1><p class='description'>" + description + "</p>";

let learnMoreDiv = document.createElement('div');
learnMoreDiv.classList.add('learn-more');

learnMoreDiv.innerHTML = "<p>Уверены, ты&nbsp;захочешь укрепить свои знания, поэтому предлагаем тебе погрузиться в&nbsp;чудесный мир городов России и&nbsp;познакомиться поближе с&nbsp;их&nbsp;историей, интересными местами&nbsp;и, конечно&nbsp;же, с&nbsp;самыми интересными новостями</p><a href='../Trips.html'><button id='articles-btn'>К статьям</button></a>";

resultDiv.appendChild(learnMoreDiv);

container.appendChild(resultDiv);

// let articlesBtn = document.getElementById('articles-btn');
// articlesBtn.addEventListener('click', function() {
// 	window.location.href = '../trips.html';
// });
}


function sendResult() {
if (document.querySelector(".answers:checked") == undefined) {
	alert("Выберите ваш ответ!")
	return
}

let userAnswer = 0;

userAnswer = document.querySelector(".answers:checked").id.substr(3)

resultForming(this.taskName, step, parseInt(userAnswer));
}

function resultForming(taskName, question, userAnswer) {
if (taskName != this.taskName) {
	throw new Error("Question is not equal:\n" + taskName + " !equal " + this.taskName);
}

console.log(taskName + " " + question + " " + userAnswer)
results.set(way[question][userAnswer], results.get(way[question][userAnswer]) == undefined ? 1 : results.get(way[question][userAnswer]) + 1);

if (step != last) {
	step++;
	initUI();
} else {
	document.querySelector(".container").innerHTML = '';
	initFinishUI();
}
}

function finishQuestion() {
let result = [];

results.forEach((val, key) => {
	if (result.length === 0) {
		result = [[key, val]];
	} else if (result[0][1] < val) {
		result = [[key, val]];
	} else if (result[0][1] === val) {
		result.push([key, val]);
	}
})

return result
}
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
</body>
</html>