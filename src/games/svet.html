<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Какая ты сторона света?</title>
    <link rel="icon" type="image/png" href="../images/favicon.svg">

</head>
<body id="blue-grey" class="test">
    <div class="games">
    <!-- менюшки  -->
    <div class="menu">
        <a href="../index.html">
            <div class="Logo">
                <img src="../images/Logo/Logo.svg" alt="">
            </div>
        </a>
        <div class="icons">
            <a href="../Trips.html">
                <div class="A_Menu-Routes">
                    <div class="Q_Menu-Routes">
                        <img src="../images/Q_Menu/3dicons.png" alt="">
                    </div>
                    <p class="p-desktop">Маршруты</p>
                </div>
            </a>
            <a href="../Advices.html">
                <div class="A_Menu-Advice">
                        <div class="Q_Menu-Adviсe">
                            <img src="../images/Q_Menu/road-bag 1.png" alt="">
                        </div>
                        <p class="p-desktop">Советы</p>
                </div>
            </a>
            <a href="../games.html">
                <div class="A_Menu-Way">
                    <div class="Q_Menu-Way">
                        <img src="../images/Q_Menu/pin 1.png" alt="">
                    </div>
                    <p class="p-desktop">В пути</p>
                </div>
            </a>
        </div>
        <!-- <div class="A_Search">
            <div class="Q_Icons-Search">
                <img src="../images/Q_Icons/Search.svg" alt="">
            </div>
            <p class="p-desktop">Поиск</p>
        </div> -->
    </div>
    <div class="menu-mobile">
        <a href="../index.html">
            <div class="Symbol">
                <img src="../images/Logo/Union.svg" alt="">
            </div>
        </a>
        <!-- <div class="A_Search">
            <div class="Q_Icons-Search">
                <img src="../images/Q_Icons/Search.svg" alt="">
            </div>
            <p class="p-desktop">Поиск</p>
        </div> -->
        <div class="Q_Icons-Burger">
            <img src="../images/Q_Icons/Burger.svg" alt="">
        </div>
    </div>
    <div class="blur-mobile"></div>
    <div class="none">
        <div class="mobile-popupMenu">
            <div class="icons-mobile">
                <div class="burger-menu">
                    <a href="../Trips.html">
                        <div class="A_Menu-Routes">
                            <div class="Q_Menu-Routes">
                                <img src="../images/Q_Menu/3dicons.png" alt="">
                            </div>
                            <p class="p-desktop">Маршруты</p>
                        </div>
                    </a>
                    <div class="mini-menu">
                        <div class="Q_Icons-Cross close">
                            <img src="../images/Q_Icons/Cross.svg" alt="">
                        </div>
                    </div>
                </div>
                <a href="../Advices.html">
                    <div class="A_Menu-Advice">
                            <div class="Q_Menu-Adviсe">
                            <img src="../images/Q_Menu/road-bag 1.png" alt="">
                            </div>
                            <p class="p-desktop">Советы</p>
                    </div>
                </a>
                <a href="../games.html">
                    <div class="A_Menu-Way">
                        <div class="Q_Menu-Way">
                            <img src="../images/Q_Menu/pin 1.png" alt="">
                        </div>
                        <p class="p-desktop">В пути</p>
                    </div>
                </a>
            </div>
        </div>
    </div>
    <div class="main-container">
        <div class="greeting">
            <h2 class="h2-desktop">Какая ты сторона света?</h2>
            <div class="A_Tag">
                <p class="p-desktop">Опрос</p>
            </div>
            <p class="p-desktop">Мы&nbsp;выделили основные стороны света, которые определяют твою личность. Узнай, какая ты&nbsp;сторона! Может быть ты&nbsp;загадочный Север? Или теплый Восток? А&nbsp;может быть ты&nbsp;импульсивный Запад? Пройди тест и&nbsp;скорее узнай, кто&nbsp;же ты!</p>
            <button onclick="hideBlock()">Начнём!</button>
        </div>
    </div>

    <div class="container">
		<div class="task">
			<h3 id="question" class="h3-desktop">EMPTY</h3>
			<div id="answers" class="p-desktop">
				EMPTY
			</div>
			<button onclick="sendResult()">Дальше</button>
		</div>
	</div>

    </div>


    <div id="blue-grey" class="footer">
        <div class="Symbol">
            <img src="../images/Logo/Union.svg" alt="">
        </div>
        <div class="hse adc">
            <p class="p-desktop">HSE ADC</p>
        </div>
        <div class="socials">
            <a href="https://t.me/trippppppp">
                <div class="Q_Social-TG">
                    <img src="../images/Q_Social/TG.svg" alt="">
                </div>
            </a>
            <a href="https://www.youtube.com/channel/UCxXUroj1PZmdlXSXDWVv72w">
                <div class="Q_Social-IG">
                    <img src="../images/Q_Social/YT.svg" alt="">
                </div>
            </a>
            <a href="https://vk.com/tripppppppppppppppppp">
                <div class="Q_Social-VK">
                    <img src="../images/Q_Social/VK.svg" alt="">
                </div>
            </a>
            <a href="https://dzen.ru/id/660491df3de7862a70cc4818">
                <div class="Q_Social-Dzen">
                    <img src="../images/Q_Social/Dzen.svg" alt="">
                </div>
            </a>
        </div>
    </div>
    <script>
        
        function hideBlock() {
	document.querySelector('.main-container').style.display = 'none';
	document.querySelector('.container').style.display = 'flex';
	let footer = document.querySelector('.footer');
	footer.style.position = 'absolute';
	footer.style.width = '95vw';
	footer.style.bottom = '0';
    if (window.matchMedia("(max-width: 480px)").matches) {
        footer.style.width = '89.4vw';
    }
    }



let taskName = "";
let questions = [];
let answers = [];
let results = new Map();
let way = [];
let step = 0;
let last = 0;

window.onload = init

function getCookie(name) {
let matches = document.cookie.match(new RegExp(
"(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
));
return matches ? decodeURIComponent(matches[1]) : undefined;
} 
// возможно куки не нужны

function setCookie(name, value, path = "/question", options = {}) {

options = {
path: path,
...options
};

if (options.expires instanceof Date) {
options.expires = options.expires.toUTCString();
}

let updatedCookie = encodeURIComponent(name) + "=" + encodeURIComponent(value);

for (let optionKey in options) {
updatedCookie += "; " + optionKey;
let optionValue = options[optionKey];
if (optionValue !== true) {
  updatedCookie += "=" + optionValue;
}
}

document.cookie = updatedCookie;
}

function getDataDB(taskName) {
questions = ["Что важнее для тебя во время путешествий?", "Как ты предпочитаешь проводить время в дороге?", "Что вдохновляет тебя больше всего во время путешествий?", "Чем ты предпочитаешь заниматься вечером в новом месте?", "Какими видами транспорта ты предпочитаешь путешествовать по России?"];
answers = [["Активный отдых и приключения.", "Исторические достопримечательности и культурное наследие.", "Природные красоты и уединение.", "Гастрономические открытия и местные кулинарные деликатесы."], ["Завести новые знакомства и поговорить с попутчиками", "Читать книгу или слушать музыку.", "Контролировать маршрут и планировать остановки заранее.", "Наблюдать за окружающими пейзажами и фотографировать интересные моменты."], ["Встреча с местными жителями и погружение в местную культуру.", "Исследование уникальных архитектурных сооружений и памятников истории.", "Прогулки по заповедным уголкам природы и национальным паркам.", "Отведение животных и местные деликатесы, чтобы узнать о кухне региона."], ["Посещать местные кафе и рестораны.", "Исследовать исторические районы и достопримечательности города.", "Прогуливаться по набережной или парку.", "Посещать мероприятия и фестивали, проходящие в городе."], ["Поездом или электричкой.", "Автомобиль", "Автобус или маршрутка.", "Самолет"]];
way = [["Восток", "Запад", "Юг", "Север"], ["Восток", "Запад", "Юг", "Север"], ["Восток", "Запад", "Юг", "Север"], ["Восток", "Запад", "Юг", "Север"], ["Восток", "Запад", "Юг", "Север"]];

return [questions, answers, way]
}

function init() {
let taskName = getCookie("taskName");

[this.questions, this.answers, this.way] = getDataDB(taskName);
step = 0;
last = this.questions.length-1
initUI();
}

function initUI() {
let div = document.querySelector("#answers");
let answerField = "";
document.querySelector("#question").innerText = this.questions[step];

this.answers[step].forEach((e, index) => {
	answerField += '<div style="margin-bottom: 0.83vw;">\
						<input type="radio" id="ANS' + index + '" class="answers" name="answer' + this.questions[step] + '" value="' + e + '"/>\n\
						<label for="ANS' + index + '">' + e + '</label>\
					</div>'
});

div.innerHTML = answerField;
}

function initFinishUI() {
let result = finishQuestion();
let container = document.querySelector(".container");

let resultDiv = document.createElement('div');
resultDiv.classList.add('result');

let congrats = "Поздравляем, ты – " + result[0][0] + "!";
let description = "";

switch (result[0][0]) {
	case "Восток":
		description = "вероятно вы энергичны, оптимистичны и стремятся к новым начинаниям. Они склонны быть творческими и вдохновленными.";
		break;
	case "Запад":
		description = "вероятно вы прагматичны, сосредоточены на целях и логически мыслят. Они часто организованны, рациональны и целеустремленны.";
		break;
	case "Юг":
		description = "вероятно вы дружелюбны, общительны и эмоционально открыты. Они часто теплые и заботливые.";
		break;
    case "Север":
	description = "вероятно вы аналитичны, независимы и стремятся к саморазвитию. Они часто спокойны, решительны и целеустремлены.";
    	break;

	default:
		description = "Ты – " + result[0][0] + ".";
}

resultDiv.innerHTML = "<h1 class='congrats'>" + congrats + "</h1><p class='description'>" + description + "</p>";

let learnMoreDiv = document.createElement('div');
learnMoreDiv.classList.add('learn-more');

learnMoreDiv.innerHTML = "<p>Узнать, какая ты&nbsp;сторона света, это конечно хорошо, но&nbsp;что на&nbsp;счёт того, чтобы узнать побольше о&nbsp;новых маршрутах для путешествий? Россия ещё совсем тобой не&nbsp;исследована, предлагаем это исправить</p><a href='../Trips.html'><button id='articles-btn'>К статьям</button></a>";

resultDiv.appendChild(learnMoreDiv);

container.appendChild(resultDiv);

// let articlesBtn = document.getElementById('articles-btn');
// articlesBtn.addEventListener('click', function() {
// 	window.location.href = '../trips.html';
// });
}


function sendResult() {
if (document.querySelector(".answers:checked") == undefined) {
	alert("Выберите ваш ответ!")
	return
}

let userAnswer = 0;

userAnswer = document.querySelector(".answers:checked").id.substr(3)

resultForming(this.taskName, step, parseInt(userAnswer));
}

function resultForming(taskName, question, userAnswer) {
if (taskName != this.taskName) {
	throw new Error("Question is not equal:\n" + taskName + " !equal " + this.taskName);
}

console.log(taskName + " " + question + " " + userAnswer)
results.set(way[question][userAnswer], results.get(way[question][userAnswer]) == undefined ? 1 : results.get(way[question][userAnswer]) + 1);

if (step != last) {
	step++;
	initUI();
} else {
	document.querySelector(".container").innerHTML = '';
	initFinishUI();
}
}

function finishQuestion() {
let result = [];

results.forEach((val, key) => {
	if (result.length === 0) {
		result = [[key, val]];
	} else if (result[0][1] < val) {
		result = [[key, val]];
	} else if (result[0][1] === val) {
		result.push([key, val]);
	}
})

return result
}
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
</body>
</html>