<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Какой ты пассажир?</title>
    <link rel="icon" type="image/png" href="../images/favicon.svg">

</head>
<body id="blue-grey" class="test">
    <div class="games">
    <!-- менюшки  -->
    <div class="menu">
        <a href="../index.html">
            <div class="Logo">
                <img src="../images/Logo/Logo.svg" alt="">
            </div>
        </a>
        <div class="icons">
            <a href="../Trips.html">
                <div class="A_Menu-Routes">
                    <div class="Q_Menu-Routes">
                        <img src="../images/Q_Menu/3dicons.png" alt="">
                    </div>
                    <p class="p-desktop">Маршруты</p>
                </div>
            </a>
            <a href="../Advices.html">
                <div class="A_Menu-Advice">
                        <div class="Q_Menu-Adviсe">
                            <img src="../images/Q_Menu/road-bag 1.png" alt="">
                        </div>
                        <p class="p-desktop">Советы</p>
                </div>
            </a>
            <a href="../games.html">
                <div class="A_Menu-Way">
                    <div class="Q_Menu-Way">
                        <img src="../images/Q_Menu/pin 1.png" alt="">
                    </div>
                    <p class="p-desktop">В пути</p>
                </div>
            </a>
        </div>
        <!-- <div class="A_Search">
            <div class="Q_Icons-Search">
                <img src="../images/Q_Icons/Search.svg" alt="">
            </div>
            <p class="p-desktop">Поиск</p>
        </div> -->
    </div>
    <div class="menu-mobile">
        <a href="../index.html">
            <div class="Symbol">
                <img src="../images/Logo/Union.svg" alt="">
            </div>
        </a>
        <!-- <div class="A_Search">
            <div class="Q_Icons-Search">
                <img src="../images/Q_Icons/Search.svg" alt="">
            </div>
            <p class="p-desktop">Поиск</p>
        </div> -->
        <div class="Q_Icons-Burger">
            <img src="../images/Q_Icons/Burger.svg" alt="">
        </div>
    </div>
    <div class="blur-mobile"></div>
    <div class="none">
        <div class="mobile-popupMenu">
            <div class="icons-mobile">
                <div class="burger-menu">
                    <a href="../Trips.html">
                        <div class="A_Menu-Routes">
                            <div class="Q_Menu-Routes">
                                <img src="../images/Q_Menu/3dicons.png" alt="">
                            </div>
                            <p class="p-desktop">Маршруты</p>
                        </div>
                    </a>
                    <div class="mini-menu">
                        <div class="Q_Icons-Cross close">
                            <img src="../images/Q_Icons/Cross.svg" alt="">
                        </div>
                    </div>
                </div>
                <a href="../Advices.html">
                    <div class="A_Menu-Advice">
                            <div class="Q_Menu-Adviсe">
                            <img src="../images/Q_Menu/road-bag 1.png" alt="">
                            </div>
                            <p class="p-desktop">Советы</p>
                    </div>
                </a>
                <a href="../games.html">
                    <div class="A_Menu-Way">
                        <div class="Q_Menu-Way">
                            <img src="../images/Q_Menu/pin 1.png" alt="">
                        </div>
                        <p class="p-desktop">В пути</p>
                    </div>
                </a>
            </div>
        </div>
    </div>
    <div class="main-container">
        <div class="greeting">
            <h2 class="h2-desktop">Какой ты пассажир?</h2>
            <div class="A_Tag">
                <p class="p-desktop">Опрос</p>
            </div>
            <p class="p-desktop">Ты&nbsp;когда-нибудь задумывался, какой ты&nbsp;пассажир? Прежде чем отправиться с&nbsp;нами в&nbsp;трип, давай проверим, насколько нам будет комфортно вместе! Может быть ты&nbsp;тот, кто обожает шутки и&nbsp;музыку? Или ты&nbsp;предпочитаешь тишину и&nbsp;покой? А&nbsp;может быть ты&nbsp;всегда готов на&nbsp;спонтанные приключения? Пройди тест и&nbsp;узнай, кто ты&nbsp;в&nbsp;нашем путешествии!</p>
            <button onclick="hideBlock()">Начнём!</button>
        </div>
    </div>

    <div class="container">
		<div class="task">
			<h3 id="question" class="h3-desktop">EMPTY</h3>
			<div id="answers" class="p-desktop">
				EMPTY
			</div>
			<button onclick="sendResult()">Дальше</button>
		</div>
	</div>

    </div>


    <div id="blue-grey" class="footer">
        <div class="Symbol">
            <img src="../images/Logo/Union.svg" alt="">
        </div>
        <div class="hse adc">
            <p class="p-desktop">HSE ADC</p>
        </div>
        <div class="socials">
            <a href="https://t.me/trippppppp">
                <div class="Q_Social-TG">
                    <img src="../images/Q_Social/TG.svg" alt="">
                </div>
            </a>
            <a href="https://www.youtube.com/channel/UCxXUroj1PZmdlXSXDWVv72w">
                <div class="Q_Social-IG">
                    <img src="../images/Q_Social/YT.svg" alt="">
                </div>
            </a>
            <a href="https://vk.com/tripppppppppppppppppp">
                <div class="Q_Social-VK">
                    <img src="../images/Q_Social/VK.svg" alt="">
                </div>
            </a>
            <a href="https://dzen.ru/id/660491df3de7862a70cc4818">
                <div class="Q_Social-Dzen">
                    <img src="../images/Q_Social/Dzen.svg" alt="">
                </div>
            </a>
        </div>
    </div>
    <script>
        
        function hideBlock() {
	document.querySelector('.main-container').style.display = 'none';
	document.querySelector('.container').style.display = 'flex';
	let footer = document.querySelector('.footer');
	footer.style.position = 'absolute';
	footer.style.width = '95vw';
	footer.style.bottom = '0';
    if (window.matchMedia("(max-width: 480px)").matches) {
        footer.style.width = '89.4vw';
    }
    }



let taskName = "";
let questions = [];
let answers = [];
let results = new Map();
let way = [];
let step = 0;
let last = 0;

window.onload = init

function getCookie(name) {
let matches = document.cookie.match(new RegExp(
"(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
));
return matches ? decodeURIComponent(matches[1]) : undefined;
} 
// возможно куки не нужны

function setCookie(name, value, path = "/question", options = {}) {

options = {
path: path,
...options
};

if (options.expires instanceof Date) {
options.expires = options.expires.toUTCString();
}

let updatedCookie = encodeURIComponent(name) + "=" + encodeURIComponent(value);

for (let optionKey in options) {
updatedCookie += "; " + optionKey;
let optionValue = options[optionKey];
if (optionValue !== true) {
  updatedCookie += "=" + optionValue;
}
}

document.cookie = updatedCookie;
}

function getDataDB(taskName) {
questions = ["Как ты обычно проводишь время за рулем?", "Кто обычно решает, куда ехать?", "Музыка в машине - это...", "Кто обычно отвечает за остановки и перекусы?", "Если в машине возникла проблема, ты обычно..."];
answers = [["С удовольствием веду машину, наслаждаюсь дорогой.", "Скучаю и мечтаю побыстрее доехать до места.", "Часто листаю телефон, чтобы найти интересные места по пути.", "Составляю план перекусов и остановок на ночлег."], ["Я сам/сама выбираю маршрут и места, которые хочется посетить.", "Я доверяю навигатору или спутнику, который знает лучший путь.", "Я предлагаю разные варианты, но в итоге решает тот, кто за рулем.", " Я забочусь о том, чтобы по пути были интересные кафе и места для отдыха."], ["Мое право выбирать музыку, которая мне нравится.", "То, что можно просто включить, чтобы не было тишины.", "Шанс найти новые музыкальные открытия и делиться ими с другими.", "Фоновая мелодия, которая помогает расслабиться и наслаждаться дорогой."], ["Я планирую все заранее, чтобы не тратить время на поиски.", "Я готов/а съесть что угодно, где угодно, лишь бы не тратить время на остановки.", "Я заглядываю в приложение с отзывами, чтобы найти лучшие места по пути.", "Я беру с собой вкусные перекусы и напитки, чтобы не тратить время на ожидание"], ["Решаешь ее самостоятельно, используя свои знания и опыт.", "Просишь помощи у кого-нибудь, кто лучше разбирается в автомобилях.", "Пытаешься успокоить всех и найти решение проблемы вместе.", "Заботишься о том, чтобы у всех было достаточно воды и еды, пока решаются проблемы."]];
way = [["водитель/водительница", "навигатор/навигаторша", "ответственный за музыку и развлечения", "организатор питания и перерывов"], ["водитель/водительница", "навигатор/навигаторша", "ответственный за музыку и развлечения", "организатор питания и перерывов"], ["водитель/водительница", "навигатор/навигаторша", "ответственный за музыку и развлечения", "организатор питания и перерывов"], ["водитель/водительница", "навигатор/навигаторша", "ответственный за музыку и развлечения", "организатор питания и перерывов"], ["водитель/водительница", "навигатор/навигаторша", "ответственный за музыку и развлечения", "организатор питания и перерывов"]];

return [questions, answers, way]
}

function init() {
let taskName = getCookie("taskName");

[this.questions, this.answers, this.way] = getDataDB(taskName);
step = 0;
last = this.questions.length-1
initUI();
}

function initUI() {
let div = document.querySelector("#answers");
let answerField = "";
document.querySelector("#question").innerText = this.questions[step];

this.answers[step].forEach((e, index) => {
	answerField += '<div style="margin-bottom: 0.83vw;">\
						<input type="radio" id="ANS' + index + '" class="answers" name="answer' + this.questions[step] + '" value="' + e + '"/>\n\
						<label for="ANS' + index + '">' + e + '</label>\
					</div>'
});

div.innerHTML = answerField;
}

function initFinishUI() {
let result = finishQuestion();
let container = document.querySelector(".container");

let resultDiv = document.createElement('div');
resultDiv.classList.add('result');

let congrats = "Поздравляем, ты – " + result[0][0] + "!";
let description = "";

switch (result[0][0]) {
	case "водитель/водительница":
		description = "Тебе нравится быть за рулем, ты сам/сама решаешь, куда ехать, и тебе нравится выбирать музыку.";
		break;
	case "навигатор/навигаторша":
		description = "Ты предпочитаешь, чтобы кто-то другой вел машину, но ты всегда готов/а найти лучший маршрут и подсказывать дорогу.";
		break;
	case "ответственный за музыку и развлечения!":
		description = "Тебе нравится создавать атмосферу в машине, предлагать новые идеи и делиться интересными находками.";
		break;
    case "организатор питания и перерывов":
	description = "Ты заботишься о комфорте всех пассажиров и делаешь все возможное, чтобы путешествие было приятным.";
    	break;

	default:
		description = "Ты – " + result[0][0] + ".";
}

resultDiv.innerHTML = "<h1 class='congrats'>" + congrats + "</h1><p class='description'>" + description + "</p>";

let learnMoreDiv = document.createElement('div');
learnMoreDiv.classList.add('learn-more');

learnMoreDiv.innerHTML = "<p>Узнать, какой ты&nbsp;пассажир, это конечно хорошо, но&nbsp;что на&nbsp;счёт того, чтобы узнать побольше о&nbsp;новых маршрутах для путешествий? Россия ещё совсем тобой не&nbsp;исследована, предлагаем это исправить</p><a href='../Trips.html'><button id='articles-btn'>К статьям</button></a>";

resultDiv.appendChild(learnMoreDiv);

container.appendChild(resultDiv);

// let articlesBtn = document.getElementById('articles-btn');
// articlesBtn.addEventListener('click', function() {
// 	window.location.href = '../trips.html';
// });
}


function sendResult() {
if (document.querySelector(".answers:checked") == undefined) {
	alert("Выберите ваш ответ!")
	return
}

let userAnswer = 0;

userAnswer = document.querySelector(".answers:checked").id.substr(3)

resultForming(this.taskName, step, parseInt(userAnswer));
}

function resultForming(taskName, question, userAnswer) {
if (taskName != this.taskName) {
	throw new Error("Question is not equal:\n" + taskName + " !equal " + this.taskName);
}

console.log(taskName + " " + question + " " + userAnswer)
results.set(way[question][userAnswer], results.get(way[question][userAnswer]) == undefined ? 1 : results.get(way[question][userAnswer]) + 1);

if (step != last) {
	step++;
	initUI();
} else {
	document.querySelector(".container").innerHTML = '';
	initFinishUI();
}
}

function finishQuestion() {
let result = [];

results.forEach((val, key) => {
	if (result.length === 0) {
		result = [[key, val]];
	} else if (result[0][1] < val) {
		result = [[key, val]];
	} else if (result[0][1] === val) {
		result.push([key, val]);
	}
})

return result
}
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
</body>
</html>